# PulseHub v0.2: 愿景、目标与技术规划

## 1. 简介

PulseHub v0.1 成功地验证了我们核心的数据采集和存储能力。v0.2 的核心使命是将平台从一个基础的数据采集系统，演进为一个具备强大实时处理能力的 **"CRM 中间件"** 平台。

我们的目标是构建一个能够实时响应用户行为、动态生成用户画像、并为上层应用（如营销自动化、个性化推荐）提供实时数据支持的高性能、高可扩展性的数据中枢。

## 2. v0.2 核心目标与愿景

- **实时用户画像 (Real-time User Profiles)**: 打破数据延迟，实现用户画像的毫秒级更新与查询。当用户在前端产生行为时，其画像数据应能立刻得到丰富和更新。
- **可扩展与可维护的架构 (Scalable & Maintainable Architecture)**: 引入先进的架构模式，如 "冷热路径分离" 和 "中央化配置管理"，以支持未来业务的快速增长和技术迭代。
- **未来增长的基石 (Foundation for Future Growth)**: v0.2 的架构将为未来更高级的功能（如实时客群细分、用户旅程分析、个性化营销触发等）打下坚实的基础。

## 3. 关键架构变革：冷热路径分离

为了同时满足实时性与数据完整性的要求，v0.2 将引入 **"冷热路径" (Hot/Cold Path)** 分离的架构。

```mermaid
graph TD
    subgraph "数据源 (Data Sources)"
        A[Web/App Clients]
    end

    subgraph "数据采集 (Ingestion)"
        B(Event Producer)
    end

    subgraph "消息队列 (Message Queue)"
        C{Kafka: user-activity-events}
    end

    subgraph "热路径 (Hot Path - Real-time Processing)"
        direction LR
        D[Stream Processor <br/>(Kafka Streams)]
        E((Redis <br/>/Cache/))
        F[Profile Service API]
    end

    subgraph "冷路径 (Cold Path - Archival & Batch)"
        direction LR
        G[Ingestion Service <br/>(Archiver)]
        H[(PostgreSQL <br/>/Data Warehouse/)]
    end
    
    subgraph "配置中心 (Configuration)"
        I[Config Server <br/>(Spring Cloud Config)]
    end

    A --> B
    B --> C

    C --> D
    D --> E
    E <--> F

    C --> G
    G --> H

    I -.-> D
    I -.-> F
    I -.-> G

    classDef default fill:#f9f9f9,stroke:#333,stroke-width:2px;
    classDef important fill:#ffc,stroke:#f00,stroke-width:2px;
    class A,B,C,D,E,F,G,H,I default;
```

- **热路径 (Hot Path)**:
  - **目标**: 追求极致的低延迟。
  - **流程**: 事件进入 Kafka后，由新的 `stream-processor` 服务（基于 Kafka Streams）进行实时消费、处理和丰富。处理结果（如更新后的用户画像）被写入 Redis 缓存。`profile-service` 将主要从 Redis 读取数据，对外提供低延迟的画像查询 API。
- **冷路径 (Cold Path)**:
  - **目标**: 保证数据的完整性和持久性，用于离线分析和数据归档。
  - **流程**: `ingestion-service` 的角色将转变为一个归档服务。它会订阅 Kafka 的原始事件，并将其持久化到 PostgreSQL 数据库中。

## 4. 新增与改造的组件

- **新增 `config-server`**:
  - **技术**: Spring Cloud Config，后端使用 Git 仓库。
  - **目的**: 实现所有微服务的配置统一管理、版本化控制和动态刷新，是系统走向规范化的关键一步。
- **新增 `stream-processor`**:
  - **技术**: Kafka Streams。
  - **目的**: 这是 v0.2 的实时处理核心。它负责消费原始事件，进行状态计算（如页面浏览次数）、数据丰富（如设备类型判断），并将结果更新到 Redis。
- **新增 `Redis`**:
  - **技术**: Redis。
  - **目的**: 作为高性能的内存数据库，用于缓存用户画像，支撑热路径的实时读写需求。
- **改造 `ingestion-service`**:
  - **新定位**: 从 v0.1 的主要数据处理者，转变为 v0.2 的**数据归档服务**，成为冷路径的关键部分。
- **改造 `profile-service`**:
  - **新定位**: 将主要数据源从直接访问数据库，切换为访问 Redis 缓存，以实现 API 的低延迟响应。数据库将作为其备用数据源或用于写入最终一致的数据。

## 5. v0.2 高阶实施路线图

我们已经通过 `task-master` 生成了详细的任务列表，并已同步到 `SOW.md`。这里是一个高阶的、按阶段划分的路线图：

1.  **阶段一：基础设施建设**
    - 搭建 Redis 服务。
    - 搭建 Spring Cloud Config Server 并创建配置仓库。
    - 调整 Kafka 环境，为多主题做准备。
2.  **阶段二：核心模型与服务改造**
    - 定义新的用户画像数据模型 (`UserProfile`)。
    - 改造 `profile-service` 以集成 Redis。
    - 建立 `profile-service` 的数据库持久化层。
3.  **阶段三：实时处理核心实现**
    - 开发 `stream-processor` 服务。
    - 实现 `stream-processor` 对用户事件的消费和处理逻辑。
4.  **阶段四：系统整合与测试**
    - 确保所有服务都能从 `config-server` 获取配置。
    - 整合热路径和冷路径的数据流。
    - 编写并执行端到端测试，验证整个流程。
5.  **阶段五：运维与文档**
    - 建立针对新组件的监控和警报。
    - 完善 v0.2 的架构和运维文档。 